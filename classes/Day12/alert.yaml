SNSTopicCloudWatchAlarm:
    Type: AWS::SNS::Topic
    Properties:
      DisplayName: "dctm-cloudwatch-alarm-topic"
      KmsMasterKeyId: !Sub 'alias/${ClusterName}_sns-alias'
      Subscription:
        - Endpoint: "anvesh.muppeda@swbc.com"
          Protocol: "email"
        - Endpoint: "preethamreddy.gotham@swbc.com"
          Protocol: "email"
        - Endpoint: "rdaniels@swbc.com"
          Protocol: "email"
        - Endpoint: "spatibandla@swbc.com"
          Protocol: "email"
        - Endpoint: "ACarballeyra@swbc.com"
          Protocol: "email"
        - Endpoint: "ranjith.kaasireddy@swbc.com"
          Protocol: "email"
        - Endpoint: "shekhar.khandebharad@swbc.com"
          Protocol: "email"
        - Endpoint: "DGopal@swbc.com"
          Protocol: "email"
        - Endpoint: "JBaldwin@swbc.com"
          Protocol: "email"
      TopicName: "dctm-cloudwatch-alarm-topic"

  CloudWatchAlaramWorkers:
    DependsOn: SNSTopicCloudWatchAlarm
    Type: AWS::CloudWatch::Alarm
    Properties:
        AlarmName: !Sub '${Environment}-${ClusterName}_worker-failures'
        AlarmDescription: |-
            In the EKS DCTM-Cluster Cluster, one or more worker nodes are having issues.
        ActionsEnabled: true
        OKActions: []
        AlarmActions:
            - !FindInMap [Environment, !Ref Environment , CWSNSArn]
        InsufficientDataActions: []
        MetricName: cluster_failed_node_count
        Namespace: ContainerInsights
        Statistic: Average
        Dimensions:
            - Name: ClusterName
              Value: !Ref ClusterName
        Period: 60
        EvaluationPeriods: 5
        DatapointsToAlarm: 3
        Threshold: 90
        ComparisonOperator: GreaterThanThreshold
        TreatMissingData: missing